<h5><%= t('analytics.portfolio.profit') %></h5>
<%- income_percent = @positions_analytics[:total][:summary][:income_percent] %>
<%- income_summary = @positions_analytics[:total][:summary][:income_cents] + @balance_analytics[:summary_cents] %>
<p>
  <%= money_presenter(income_summary, 'RUB') %>
  (<span class='<%= 'positive' if income_percent.positive? %>'><%= '+' if income_percent.positive? %><%= income_percent %>%</span>)
</p>

<h4><%= t('analytics.balance.title') %></h4>
<div class='mb-8'>
  <% @balance_analytics[:stats].each do |currency, value| %>
    <p><%= money_presenter(value, currency) %></p>
  <% end %>
</div>

<% %i[share foundation bond].each do |key| %>
  <% if @positions_analytics[key][:stats].present? %>
    <h4><%= t("analytics.table.#{key}_name") %></h4>

    <table class='positions-table mb-8'>
      <thead>
        <tr>
          <th class='name-column'><%= t('analytics.table.name') %></th>
          <th><%= t('analytics.table.amount') %></th>
          <th><%= t('analytics.table.total_price') %></th>
          <th><%= t('analytics.table.current_total_price') %></th>
          <th><%= t('analytics.table.average_price') %></th>
          <th><%= t('analytics.table.current_price') %></th>
          <th><%= t('analytics.table.income') %></th>
          <th><%= t('analytics.table.exchange_profit') %></th>
        </tr>
      </thead>
      <tbody>
        <% @positions_analytics[key][:stats].each do |quote, stats| %>
          <tr class='position'>
            <td class='name-column'><%= quote.security.name[I18n.locale.to_s] %></td>
            <td><%= stats[:unsold_amount] %></td>
            <td><%= money_presenter(stats[:buying_unsold_cents], quote.price_currency) %></td>
            <td><%= money_presenter(stats[:selling_unsold_cents], quote.price_currency) %></td>
            <td><%= money_presenter(stats[:buying_unsold_average_cents], quote.price_currency) %></td>
            <td><%= money_presenter(quote.price_cents, quote.price_currency) %></td>
            <td><%= money_presenter(stats[:selling_unsold_income_cents], quote.price_currency) %></td>
            <td><%= stats[:exchange_profit] %>%</td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>

  <% if @positions_analytics[key][:plans].present? %>
    <h5><%= t("analytics.table.header.plan_#{key}") %></h5>

    <table class='positions-table mb-8'>
      <thead>
        <tr>
          <th class='name-column'><%= t('analytics.table.name') %></th>
          <th><%= t('analytics.table.amount') %></th>
          <th><%= t('analytics.table.total_price') %></th>
          <th><%= t('analytics.table.plan_price') %></th>
          <th><%= t('analytics.table.current_price') %></th>
        </tr>
      </thead>
      <tbody>
        <% @positions_analytics[key][:plans].each do |quote, stats| %>
          <tr class='position plan'>
            <td class='name-column'><%= quote.security.name[I18n.locale.to_s] %></td>
            <td><%= stats[:amount] %></td>
            <td><%= money_presenter(stats[:selling_total_cents], quote.price_currency) %></td>
            <td><%= money_presenter(stats[:price_cents], quote.price_currency) %></td>
            <td><%= money_presenter(quote.price_cents, quote.price_currency) %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
<% end %>

<% if @actives_pie_stats.size.positive? %>
  <h5><%= t('analytics.actives.header') %></h5>

  <div class='sectors-chart-box mb-8'>
    <div
      id='actives-pie-container'
      data-controller='analytics--actives'
      data-analytics--actives-pie-value='<%= @actives_pie_stats.to_json %>'
    >
      <canvas id='actives-pie' width='600' height='200'></canvas>
    </div>
    <div id='actives-legend'></div>
  </div>
<% end %>

<% if @sector_pie_stats.size.positive? %>
  <h5><%= t('analytics.sectors.header') %></h5>

  <div class='sectors-chart-box mb-8'>
    <div
      id='sectors-pie-container'
      data-controller='analytics--sectors'
      data-analytics--sectors-pie-value='<%= @sector_pie_stats.to_json %>'
    >
      <canvas id='sectors-pie' width='600' height='200'></canvas>
    </div>
    <div id='legend'></div>
  </div>
<% end %>
