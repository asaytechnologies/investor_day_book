<%= render PageWrappers::PageComponent.new do %>
  <div id='portfolios-index-page' class='page-container sidebar-container'>

    <%= render Shared::HeaderComponent.new(current_user: current_user) %>

    <section class='content-header'>
      <div class='content-header-body container'>
        <h4 class='content-title'><%= t('wrapper.navigation.portfolios') %></h4>
        <div class='content-buttons'>
          <div data-behavior='new-portfolio-sidebar'>
            <span class='button button-sm button-reverse' @click.prevent='openSidebar()'>
              <%= t('portfolios.sidebar.list.button') %>
            </span>

            <%= render Shared::SidebarComponent.new(title: t('portfolios.sidebar.list.title')) do %>
              <div id='portfolio-new-container' class='sidebar-content'>
                <form>
                  <div class='form-field'>
                    <label class='form-label'><%= t('portfolios.sidebar.list.name') %> *</label>
                    <input class='form-value' v-model='name' :class='{ error: validation && name.length === 0 }' />
                  </div>

                  <div class='form-field'>
                    <label class='form-label'><%= t('portfolios.index.form_new.currency') %>*</label>
                    <div class='form-value select-value' @click.prevent='toggleCurrencySelect()'>{{ currencyName }}</div>
                    <div class='select-list' v-show='isCurrencySelectOpen'>
                      <% Cashable::AVAILABLE_CURRENCIES_UPCASE.each.with_index do |currency, index| %>
                        <div class='select-list-item' @click.prevent="selectCurrency('<%= currency %>', <%= index %>)">
                          <%= currency %>
                        </div>
                      <% end %>
                    </div>
                  </div>

                  <div class='form-field'>
                    <label class='form-label'><%= t('portfolios.index.form_new.select_source') %></label>
                    <div class='form-value select-value' @click.prevent='toggleSourceSelect()'>{{ sourceName }}</div>
                    <div class='select-list' v-show='isSourceSelectOpen'>
                      <div class='select-list-item' @click.prevent="selectBroker('', -1, '')">
                        <%= t('portfolios.index.form_new.no_source') %>
                      </div>
                      <% Brokerable::LISTABLE_BROKERS.select { |e| e[:available] }.each do |broker| %>
                        <div
                          class='select-list-item'
                          @click.prevent="selectBroker('<%= broker[:name][I18n.locale] %>', <%= broker[:index] %>, '<%= broker[:formats] %>')"
                        >
                          <%= broker[:name][I18n.locale] %>
                        </div>
                      <% end %>
                    </div>
                  </div>

                  <div class='form-field'>
                    <label class='form-label'><%= t('portfolios.sidebar.list.file') %></label>
                    <input type='file' class='form-value' v-bind:accept='fileFormats' v-bind:disabled='!isSourceSelected' />
                    <em><%= t('portfolios.sidebar.list.file_optional') %></em>
                  </div>

                  <button class='button' @click.prevent='submitForm()'>
                    <%= t('portfolios.sidebar.list.button') %>
                  </button>
                </form>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </section>

    <div id='portfolios' class='page-content portfolios-list'>
      <%= render Portfolios::ListComponent.new(current_user: current_user) %>
    </div>
  </div>
<% end %>
